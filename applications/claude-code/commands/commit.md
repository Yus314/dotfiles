---
description: "変更をインテリジェントに分析し、複数のアトミックで規約に準拠したコミット作成をガイドします"
allowed-tools: [
  "Bash(git status:*)",
  "Bash(git diff:*)",
  "Bash(git add:*)",
  "Bash(git commit:*)",
  "Bash(git reset:*)",
  "ReadFile"
]
argument-hint: "[オプション: --quick | --detailed | --interactive]"
---

# インテリジェントGitコミット分割アシスタント

## 初期コンテキスト収集
- 現在のブランチ: !`git branch --show-current`
- リポジトリステータス: !`git status --short`
- 最近のコミット履歴: !`git log --oneline -5`

---

## ワークフロー実行

### ステップ1: 変更の包括的分析

まず、リポジトリの現在の状態を完全に把握します：

```bash
# ステータスの詳細確認
!git status --porcelain

# 未ステージの変更を確認
!git diff --name-status

# ステージ済みの変更があるか確認
!git diff --cached --name-status
変更の分析結果を以下の観点で整理します：

変更の種類: 新規ファイル、修正、削除、リネーム
影響範囲: 機能領域、モジュール、レイヤー
論理的グループ: 関連する変更のまとまり

ステップ2: アトミックコミット計画の策定
Conventional Commits仕様準拠
使用するコミットタイプ：

feat: 新機能（ユーザー向けの新しい機能）
fix: バグ修正（ユーザー向けのバグ修正）
docs: ドキュメントのみの変更
style: コードの意味に影響しない変更（空白、フォーマット等）
refactor: バグ修正でも新機能でもないコード変更
perf: パフォーマンスを向上させるコード変更
test: 不足しているテストの追加や既存のテストの修正
chore: ビルドプロセスや補助ツールの変更

コミット分割の原則

単一責任の原則: 各コミットは1つの論理的変更のみを含む
自己完結性: 各コミットでビルドが通る状態を維持
意味のある単位: 後で revert や cherry-pick しやすい単位

変更を分析し、以下のような計画を提案します：
📋 コミット計画:
1. [type]: 簡潔な説明（影響するファイル数）
2. [type]: 簡潔な説明（影響するファイル数）
...
確認: この計画で進めてよろしいですか？ (yes/no/modify)
ステップ3: 段階的実行
計画承認後、各コミットを順番に処理します：
3.1 ファイルの選択的ステージング
bash# 関連ファイルを特定してステージング
!git add <specific-files>

# 必要に応じて部分的なステージング
# !git add -p <file> # インタラクティブな部分追加
3.2 ステージング内容の検証
bash# ステージされた変更の確認
!git diff --cached --stat
!git diff --cached
確認: ステージされた変更は計画項目「[項目名]」と一致していますか？
3.3 コミットメッセージの構築
<type>(<scope>): <subject>

<body>

<footer>
生成されたメッセージ:
[ここに具体的なメッセージ]
確認: このメッセージでコミットしてよろしいですか？ (yes/edit/skip)
3.4 コミット実行
bash!git commit -m "承認されたメッセージ"
ステップ4: 進捗管理とエラーハンドリング
各コミット後：

✅ 完了: [コミットハッシュ] - [コミットメッセージの1行目]
📊 進捗: [完了数]/[総計画数]
🔍 残り: !git status --short

エラー発生時の対処：

ステージングミス: git reset HEAD <file> で修正
コミット取り消し: git reset --soft HEAD~1 で再試行
マージコンフリクト: 解決方法をガイド

最終ステップ: 完了レポート
🎉 すべての変更が正常にコミットされました！

📝 作成されたコミット:
!git log --oneline -[作成したコミット数]

📊 統計:
- 総コミット数: [数]
- 変更されたファイル: [数]
- 追加/削除された行数:

💡 次のアクション:
- [ ] git push でリモートに反映
- [ ] プルリクエストの作成
- [ ] CI/CDパイプラインの確認
高度なオプション
--quick モード
最小限の確認で迅速に処理（経験豊富なユーザー向け）
--detailed モード
各ステップで詳細な説明とコンテキストを提供
--interactive モード
git add -p を使用した細かい制御（複雑な変更向け）
