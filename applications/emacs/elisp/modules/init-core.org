#+TITLE: Core Settings
* Header
#+begin_src emacs-lisp :tangle yes
  ;;; init-core.el --- Core settings -*- lexical-binding: t -*-
#+end_src
* exec-path-from-shell[macOS]
#+begin_src emacs-lisp :tangle yes
    (when (memq window-system '(mac ns x))
      (require 'exec-path-from-shell)
      (dolist (var '("GNUPGHOME" "NIX_PATH"))
      (add-to-list 'exec-path-from-shell-variables var))
      (exec-path-from-shell-initialize))
#+end_src
* パッケージを読み込まないようにする
#+begin_src emacs-lisp :tangle yes
 ; (require 'profiler) ;; Profiler start removed
 ; (profiler-start 'cpu) ;; Profiler start removed
  (setq debug-on-error t)
#+end_src
* じかん計測
#+begin_src emacs-lisp :tangle yes
    ;(require 'esup)
  ;;;;;;;;;;;;;;;;;;(setq esup-depth 0)
#+end_src
* builtin properties
#+begin_src emacs-lisp :tangle yes
  (setq user-full-name "Yusuke Kakinuma")
  (setq default-directory "~/")
#+end_src
#+begin_src emacs-lisp :tangle yes
  (setq custom-file (locate-user-emacs-file "custom.el"))
#+end_src
* GPG
** epa-file
#+begin_src emacs-lisp :tangle yes
  (autoload-if-found '(epa-file-enable) "epa-file" nil t)

(add-hook 'emacs-startup-hook #'epa-file-enable)

(fset 'epg-wait-for-status 'ignore)

(with-eval-after-load 'epa-hook
  (setopt epa-file-encrypt-to '("49B685E0425E0EA4BADADA84AAEBE97A7B2544C0")))

(with-eval-after-load 'epa-file
  ;; config
  (setopt epa-file-select-keys 'silent)
  (setopt epa-file-cache-passphrase-for-symmetric-encryption t))

(with-eval-after-load 'epg-config
  ;; config
  (setopt epg-pinentry-mode 'loopback))
#+end_src
* 一般設定
#+begin_src emacs-lisp :tangle yes
  (add-hook 'emacs-startup-hook #'smooth-scroll-mode)
  (autoload 'smooth-scroll-mode "smooth-scroll" nil t)

  (setq scroll-conservatively 35)
  (setq scroll-step 1)
  (setq scroll-margin 5)
  (setq scroll-preserve-screen-position t)

  (setq blink-cursor-idle-time 1)  ;; 入力停止から点滅開始までの秒数
  (setq blink-cursor-interval 0.3)  ;; 点滅の間隔（秒）
  (setq blink-cursor-blinks 0)      ;; 0は無限に点滅を続けることを意味する
  (blink-cursor-mode -1)             ;; カーソル点滅モードを有効化
#+end_src
** Clip board
Waylandでペーストできるようにする設定
#+begin_src emacs-lisp :tangle yes
  (when (equal system-type 'gnu/linux)
  (setq wl-copy-process nil)
    (defun wl-copy (text)
      (setq wl-copy-process (make-process :name "wl-copy"
                                          :buffer nil
                                          :command '("wl-copy" "-f" "-n")
                                          :connection-type 'pipe
                                          :noquery t))
      (process-send-string wl-copy-process text)
      (process-send-eof wl-copy-process))
  (defun wl-paste ()
    (if (and wl-copy-process (process-live-p wl-copy-process))
        nil
      (shell-command-to-string "wl-paste -n")))
  (setq interprogram-cut-function 'wl-copy)
  (setq interprogram-paste-function 'wl-paste)
  )
#+end_src
** 起動時間測定
#+begin_src emacs-lisp :tangle yes
  (defconst my/before-load-init-time (current-time))

  ;;;###autoload
  (defun my/load-init-time ()
    "Loading time of user init files including time for `after-init-hook'."
    (let ((time1 (float-time
                  (time-subtract after-init-time my/before-load-init-time)))
          (time2 (float-time
                  (time-subtract (current-time) my/before-load-init-time))))
      (message (concat "Loading init files: %.0f [msec], "
                       "of which %.f [msec] for `after-init-hook'.")
               (* 1000 time1) (* 1000 (- time2 time1)))))
  (add-hook 'after-init-hook #'my/load-init-time t)

  (defvar my/tick-previous-time my/before-load-init-time)

  ;;;###autoload
  (defun my/tick-init-time (msg)
    "Tick boot sequence at loading MSG."
    (when my/loading-profile-p
      (let ((ctime (current-time)))
        (message "---- %5.2f[ms] %s"
                 (* 1000 (float-time
                          (time-subtract ctime my/tick-previous-time)))
                 msg)
        (setq my/tick-previous-time ctime))))

  (defun my/emacs-init-time ()
    "Emacs booting time in msec."
    (interactive)
    (message "Emacs booting time: %.0f [msec] = `emacs-init-time'."
             (* 1000
                (float-time (time-subtract
                             after-init-time
                             before-init-time)))))

  (add-hook 'after-init-hook #'my/emacs-init-time)
#+end_src
* キーバインディング
#+begin_src emacs-lisp :tangle yes
  (keymap-global-set "C-q"  'scroll-down-command) ;元々M-vだったが、入力しにくいので、そっちをvterm-toggleにした
#+end_src
* Provide
#+begin_src emacs-lisp :tangle yes
  (provide 'init-core)
#+end_src
